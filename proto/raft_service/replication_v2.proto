syntax = "proto3";

package typedb.protocol;

// Main request wrapper
message StateMutationRequest {
    oneof request {
        LoadRequest load = 1;
        DatabaseManagerRequest database_manager = 2;
        DatabaseCommitRequest database_commit = 3;
        UserManagerRequest user_manager = 4;
    }
}

// Load request
message LoadRequest {
    // Empty message for load operation
}

// Database manager requests
message DatabaseManagerRequest {
    oneof request {
        DatabaseAllRequest all = 1;
        DatabaseGetRequest get = 2;
        DatabaseGetUnrestrictedRequest get_unrestricted = 3;
        DatabaseCreateRequest create = 4;
        DatabaseCreateUnrestrictedRequest create_unrestricted = 5;
        DatabaseDeleteRequest delete = 6;
    }
}

message DatabaseAllRequest {
    // Empty message for all databases request
}

message DatabaseGetRequest {
    string name = 1;
}

message DatabaseGetUnrestrictedRequest {
    string name = 1;
}

message DatabaseCreateRequest {
    string name = 1;
}

message DatabaseCreateUnrestrictedRequest {
    string name = 1;
}

message DatabaseDeleteRequest {
    string name = 1;
}

// Database commit requests
message DatabaseCommitRequest {
    oneof request {
        DatabaseSchemaCommitRequest schema = 1;
        DatabaseDataCommitRequest data = 2;
    }
}

message DatabaseSchemaCommitRequest {
    string name = 1;
    bytes commit_record = 2;
}

message DatabaseDataCommitRequest {
    string name = 1;
    bytes commit_record = 2;
}

// User manager requests
message UserManagerRequest {
    oneof request {
        UserAllRequest all = 1;
        UserGetRequest get = 2;
        UserContainsRequest contains = 3;
        UserCreateRequest create = 4;
        UserUpdateRequest update = 5;
        UserDeleteRequest delete = 6;
    }
}

message UserAllRequest {
    string accessor = 1;
}

message UserGetRequest {
    string name = 1;
    string accessor = 2;
}

message UserContainsRequest {
    string name = 1;
}

message UserCreateRequest {
    bytes commit_record = 1;
}

message UserUpdateRequest {
    bytes commit_record = 1;
}

message UserDeleteRequest {
    bytes commit_record = 1;
}

// Response wrapper
message StateMutationResponse {
    oneof response {
        LoadResponse load = 1;
        DatabaseManagerResponse database_manager = 2;
        DatabaseCommitResponse database_commit = 3;
        UserManagerResponse user_manager = 4;
    }
}

// Load response
message LoadResponse {
    // Empty message for load response
}

// Database manager responses
message DatabaseManagerResponse {
    oneof response {
        DatabaseAllResponse all = 1;
        DatabaseGetResponse get = 2;
        DatabaseGetUnrestrictedResponse get_unrestricted = 3;
        DatabaseCreateResponse create = 4;
        DatabaseCreateUnrestrictedResponse create_unrestricted = 5;
        DatabaseDeleteResponse delete = 6;
    }
}

message DatabaseAllResponse {
    repeated string databases = 1;
    optional string error = 2;
}

message DatabaseGetResponse {
    optional bytes database = 1; // Serialized database or null
    optional string error = 2;
}

message DatabaseGetUnrestrictedResponse {
    optional bytes database = 1; // Serialized database or null
    optional string error = 2;
}

message DatabaseCreateResponse {
    optional string error = 1;
}

message DatabaseCreateUnrestrictedResponse {
    optional string error = 1;
}

message DatabaseDeleteResponse {
    optional string error = 1;
}

// Database commit responses
message DatabaseCommitResponse {
    oneof response {
        DatabaseSchemaCommitResponse schema = 1;
        DatabaseDataCommitResponse data = 2;
    }
}

message DatabaseSchemaCommitResponse {
    optional string error = 1;
}

message DatabaseDataCommitResponse {
    optional string error = 1;
}

// User manager responses
message UserManagerResponse {
    oneof response {
        UserAllResponse all = 1;
        UserGetResponse get = 2;
        UserContainsResponse contains = 3;
        UserCreateResponse create = 4;
        UserUpdateResponse update = 5;
        UserDeleteResponse delete = 6;
    }
}

message UserAllResponse {
    repeated bytes users = 1; // Serialized users
    optional string error = 2;
}

message UserGetResponse {
    bytes user = 1; // Serialized user
    optional string error = 2;
}

message UserContainsResponse {
    bool contains = 1;
    optional string error = 2;
}

message UserCreateResponse {
    optional string error = 1;
}

message UserUpdateResponse {
    optional string error = 1;
}

message UserDeleteResponse {
    optional string error = 1;
}
