// This Source Code Form is subject to the terms of the Mozilla Public
// License, v. 2.0. If a copy of the MPL was not distributed with this
// file, You can obtain one at https://mozilla.org/MPL/2.0/.

syntax = "proto3";

package typedb.protocol;

message Replication {
    message Req {
        uint64 from_id = 1;
        string from_address = 2;
        StateMutationRequest state_mutation_request = 3;
    }

    message Res {}
}

message StateMutationRequest {
    oneof request {
        LoadRequest load = 1;
        DatabaseManagerRequest database_manager = 2;
        DatabaseCommitRequest database_commit = 3;
        UserManagerRequest user_manager = 4;
    }
}

// Load request
message LoadRequest {
    // Empty message for load operation
}

// Database manager requests
message DatabaseManagerRequest {
    oneof request {
        DatabaseAllRequest all = 1;
        DatabaseGetRequest get = 2;
        DatabaseGetUnrestrictedRequest get_unrestricted = 3;
        DatabaseCreateRequest create = 4;
        DatabaseCreateUnrestrictedRequest create_unrestricted = 5;
        DatabaseDeleteRequest delete = 6;
    }
}

message DatabaseAllRequest {
    // Empty message for all databases request
}

message DatabaseGetRequest {
    string name = 1;
}

message DatabaseGetUnrestrictedRequest {
    string name = 1;
}

message DatabaseCreateRequest {
    string name = 1;
}

message DatabaseCreateUnrestrictedRequest {
    string name = 1;
}

message DatabaseDeleteRequest {
    string name = 1;
}

// Database commit requests
message DatabaseCommitRequest {
    oneof request {
        DatabaseSchemaCommitRequest schema = 1;
        DatabaseDataCommitRequest data = 2;
    }
}

message DatabaseSchemaCommitRequest {
    string name = 1;
    bytes commit_record = 2;
}

message DatabaseDataCommitRequest {
    string name = 1;
    bytes commit_record = 2;
}

// User manager requests
message UserManagerRequest {
    oneof request {
        UserAllRequest all = 1;
        UserGetRequest get = 2;
        UserContainsRequest contains = 3;
        UserCreateRequest create = 4;
        UserUpdateRequest update = 5;
        UserDeleteRequest delete = 6;
    }
}

message UserAllRequest {
    string accessor = 1;
}

message UserGetRequest {
    string name = 1;
    string accessor = 2;
}

message UserContainsRequest {
    string name = 1;
}

message UserCreateRequest {
    bytes commit_record = 1;
}

message UserUpdateRequest {
    bytes commit_record = 1;
}

message UserDeleteRequest {
    bytes commit_record = 1;
}
